# Streams

Redis>5.0

## Introduction

A stream is a sequence of entries. An stream entry is composed of an ID and a message content structured like a hash object (set of key value pairs).

## Use cases

- Event sourcing (record user activity, click, pages, mousemove, etc.)
- Sensor monitoring (listening for temperature, weight, position, battery level, etc.)
- User Notifications

## Create a stream

Just log info in the stream:

```
XADD truck:1 * battery_level 99.9 lat 23.4565 long 12.12345 alt 102 driver JLG
XADD truck:2 * battery_level 34.5 lat 23.4234 long 12.56753 alt 102 driver JCD
XADD truck:1 * battery_level 99.9 lat 23.4565 long 12.12345 alt 102 driver JLG
XADD truck:2 * battery_level 34.4 lat 23.4239 long 12.56759 alt 102 driver JCD
```

## Read the entire stream object

```
XRANGE truck:1 - +
```

## Read the entire stream object by bulk

```
XRANGE truck:1 - + COUNT 100
// it returns a list of records with the <id>
// then takes the last id and do:
XRANGE truck:1 (<last-id> + COUNT 100
// repeat until the end.
```

## Read as it publish in real time

```

XREAD BLOCK 0 STREAMS truck:1 $
// and then pick the last id from the response
XREAD BLOCK 0 STREAMS truck:1 <last-id>
// repeat this until you want to stop

```

## Consumer Group

Consumer group can be created on a stream, and removed.
Consumer group are a set of consumers. So a consumer can be added to or removed from a consumer group.
Consumer can read stream entry. This make them pending. Then consumer can acknewlegde stream entry.
A consumer can claim pending entries that have reached a timeout.

See the Github project : https://jlg-formation.github.io/webdis-client/

## Questions

1. How we get the length of a stream?
2. What is the format of an autogenerated stream id?
3. How to get the full content of a given stream?
4. Is there an SCAN command for stream? Is no, how we scan a stream?
5. Is there a command to give the stream in reverse?
6. How to add a consumer group to a stream ?
7. How to destroy a consumer group to a stream ?
8. How to get the pending stream entry of a consumer group ?
9. How to create a consumer ?
10. How to destroy a consumer ?
11. How to claim one pending stream entry from a consumer group that have reache 10s of timeout ?
12. How to read a stream entry as a consumer inside a consumer group and thus making it pending ?
